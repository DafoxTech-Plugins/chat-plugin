"use strict";var{dbi,machine_id}=require("plugin-core"),Chat=require("./chat"),MutedDevice=require("./muted_device"),model_files={Chat:Chat,MutedDevice:MutedDevice};exports.init=async()=>{if(dbi){for(var{sequelize:default_scope,Sequelize}=dbi,db=await default_scope.getInstance(),keys=Object.keys(model_files),i=0;i<keys.length;i++){var k=keys[i];dbi.models[k]=model_files[k](db,Sequelize);try{await dbi.models[k].sync({alter:!0})}catch(e){}}default_scope={where:{machine_id:machine_id}};return dbi.models.Chat.addScope("default_scope",default_scope),dbi.models.Chat.belongsTo(dbi.models.MobileDevice),dbi.models.MobileDevice.hasMany(dbi.models.Chat),dbi.models.MutedDevice.addScope("default_scope",default_scope),dbi.models.MutedDevice.belongsTo(dbi.models.MobileDevice),dbi}};